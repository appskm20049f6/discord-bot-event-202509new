<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Discord Bot 後台管理</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background: #f4f4f4; }
    .container { display: flex; height: 100vh; }
    .sidebar { width: 270px; background: #222; color: #fff; padding-top: 40px; border-radius: 24px; box-shadow: 0 6px 24px #0002; margin: 24px 0 24px 24px; display: flex; flex-direction: column; align-items: stretch; }
    .sidebar h3 { text-align:center; margin-bottom:32px; font-size:20px; letter-spacing:2px; }
    .card-select {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 16px #0003;
      padding: 28px 18px 24px 18px;
      margin: 0 0 32px 0;
      display: flex;
      flex-direction: column;
      gap: 22px;
      align-items: stretch;
      box-sizing: border-box;
    }
    .select-group { display: flex; flex-direction: column; gap: 10px; }
    .select-group label { font-weight: bold; color: #333; font-size: 16px; }
    .select-box, #channelSearch {
      width: 100%; min-width: 0; max-width: 100%; padding: 12px 16px; border-radius: 10px; border: 1px solid #ccc; font-size: 17px; background: #f8f8f8; box-sizing: border-box; margin: 0; display: block;
    }
    .sidebar .menu { list-style:none; padding:0; margin-top:24px; }
    .sidebar .menu li { padding:18px 28px; cursor:pointer; font-size:17px; border-radius:8px; margin-bottom:8px; transition:background 0.2s; }
    .sidebar .menu li.active, .sidebar .menu li:hover { background:#007bff; color:#fff; }
    .main { flex:1; background:#fff; padding:48px 64px; overflow:auto; border-radius:24px; margin:24px; box-shadow:0 6px 24px #0001; min-width:400px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div class="card-select">
        <div class="select-group">
          <label for="guilds">選擇DC伺服器</label>
          <select id="guilds" class="select-box"></select>
        </div>
        <div class="select-group">
          <label for="channels">選擇頻道</label>
          <input id="channelSearch" class="select-box" type="text" placeholder="搜尋頻道名稱..." />
          <select id="channels" class="select-box"></select>
        </div>
      </div>
      <h3>管理工具</h3>
      <ul class="menu">
  <li id="menu-lottery" class="active" onclick="loadPage('lottery')">問答抽獎</li>
  <li id="menu-manual-lottery" onclick="loadPage('manual-lottery')">手動抽獎活動</li>
  <li id="menu-record" onclick="loadPage('record')">問答抽獎紀錄</li>
  <li id="menu-analysis" onclick="loadPage('analysis')">文字聊天數據分析</li>
      </ul>
    </div>
    <div class="main" id="main-content">
      <h2 style="margin-top:0;">歡迎使用 Discord Bot 後台管理系統</h2>
      <p>請從左側選單選擇功能分頁。</p>
    </div>
  </div>
  <!-- Discord Token 輸入彈窗 -->
<div id="tokenModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0008;z-index:9999;align-items:center;justify-content:center;">
  <div style="background:#fff;padding:32px 28px;border-radius:18px;box-shadow:0 4px 24px #0006;min-width:320px;max-width:90vw;">
    <h3 style="margin-top:0;">請輸入 Discord Bot Token</h3>
    <input id="tokenInput" type="text" placeholder="Bot Token" style="width:100%;padding:12px 16px;font-size:17px;margin-bottom:18px;border-radius:8px;border:1px solid #ccc;" />
    <div style="text-align:right;">
      <button id="tokenSubmit" style="padding:10px 24px;font-size:16px;border-radius:8px;background:#007bff;color:#fff;border:none;cursor:pointer;">送出</button>
    </div>
    <p id="tokenError" style="color:#d00;margin-top:12px;display:none;"></p>
  </div>
</div>

<script>
// 檢查 BOT 狀態
async function checkBotStatus() {
  try {
    const res = await fetch('/api/bot-status');
    const data = await res.json();
    if (!data.connected) {
      document.getElementById('tokenModal').style.display = 'flex';
    }
  } catch (e) {
    document.getElementById('tokenModal').style.display = 'flex';
  }
}
checkBotStatus();

// Token 送出
const tokenSubmit = document.getElementById('tokenSubmit');
tokenSubmit.onclick = async function() {
  const token = document.getElementById('tokenInput').value.trim();
  if (!token) {
    document.getElementById('tokenError').innerText = '請輸入 Token';
    document.getElementById('tokenError').style.display = 'block';
    return;
  }
  document.getElementById('tokenError').style.display = 'none';
  // 呼叫 API 設定 Token
  const res = await fetch('/api/set-token', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ token })
  });
  const data = await res.json();
  if (data.success) {
    document.getElementById('tokenModal').style.display = 'none';
    alert('Token 已設定，請重新啟動 BOT！');
  } else {
    document.getElementById('tokenError').innerText = data.error || '設定失敗';
    document.getElementById('tokenError').style.display = 'block';
  }
};
</script>
  <script src="main.js"></script>
<!-- main.js 需支援 loadPage('lottery-record') 載入 lottery-record.html -->
</body>
</html>
