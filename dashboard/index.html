<!DOCTYPE html>
<html lang="zh-TW">
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Discord Bot 後台管理</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background: #f4f4f4; }
    .container { display: flex; height: 100vh; }
    .sidebar { width: 240px; background: #222; color: #fff; padding-top: 32px; }
    .sidebar h3 { text-align:center; margin-bottom:24px; }
    .card-select {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 16px #0003;
      padding: 24px 20px 20px 20px;
      margin: 0 20px 32px 20px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: stretch;
    }
    .select-group { margin-bottom: 0; display: flex; flex-direction: column; gap: 8px; }
    .select-group label {
      font-weight: bold;
      color: #333;
      font-size: 15px;
      margin-bottom: 0;
    }
    .select-box, #channelSearch {
      width: 100%;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      background: #f8f8f8;
      margin-bottom: 0;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }
    .select-box:focus, #channelSearch:focus {
      border-color: #007bff;
      outline: none;
    }
    .sidebar .menu { list-style:none; padding:0; }
    .sidebar .menu li { padding:16px 24px; cursor:pointer; }
    .sidebar .menu li.active, .sidebar .menu li:hover { background:#007bff; color:#fff; }
    .main { flex:1; background:#fff; padding:32px; overflow:auto; }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div class="card-select">
        <div class="select-group">
          <label for="guilds">選擇DC伺服器</label>
          <select id="guilds" class="select-box"></select>
        </div>
        <div class="select-group">
          <label for="channels">選擇發布頻道</label>
          <input id="channelSearch" class="select-box" type="text" placeholder="搜尋頻道名稱..." style="margin-bottom:8px;" />
          <select id="channels" class="select-box"></select>
        </div>
      </div>
      <h3>管理工具</h3>
      <ul class="menu">
        <li id="menu-lottery" class="active" onclick="loadPage('lottery')">抽獎</li>
      </ul>
    </div>
    <div class="main" id="main-content">
      <!-- AJAX 載入內容 -->
    </div>
  </div>
  <script>
    // 載入伺服器選單
    fetch('http://localhost:3030/api/guilds')
      .then(res => res.json())
      .then(guilds => {
        const guildSel = document.getElementById('guilds');
        guildSel.innerHTML = '';
        guilds.forEach(g => {
          const opt = document.createElement('option');
          opt.value = g.id;
          opt.textContent = g.name;
          guildSel.appendChild(opt);
        });
        if (guilds.length) loadChannels(guilds[0].id);
      });

    document.getElementById('guilds').onchange = e => {
      loadChannels(e.target.value);
    };

    // 載入頻道選單
    let allChannels = [];
    function loadChannels(guildId) {
      fetch(`http://localhost:3030/api/guilds/${guildId}/channels`)
        .then(res => res.json())
        .then(channels => {
          allChannels = channels;
          renderChannelOptions('');
        });
    }

    // 搜尋式頻道選單
    function renderChannelOptions(keyword) {
      const chSel = document.getElementById('channels');
      chSel.innerHTML = '';
      const filtered = allChannels.filter(ch => ch.name.toLowerCase().includes(keyword.toLowerCase()));
      filtered.forEach(ch => {
        const opt = document.createElement('option');
        opt.value = ch.id;
        opt.textContent = ch.name;
        chSel.appendChild(opt);
      });
    }

    document.getElementById('channelSearch').addEventListener('input', e => {
      renderChannelOptions(e.target.value);
    });

    // 工具頁 AJAX 載入
    function loadPage(page) {
      document.querySelectorAll('.menu li').forEach(li => li.classList.remove('active'));
      document.getElementById('menu-' + page).classList.add('active');
      fetch(page + '.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById('main-content').innerHTML = html;
        });
    }
    loadPage('lottery');
  </script>
</body>
</html>
       