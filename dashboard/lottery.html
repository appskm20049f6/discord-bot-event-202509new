<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>問答抽獎</title>
  <style>
    body { background:#fff; font-family:Arial,sans-serif; }
    .lottery-container { max-width:480px; margin:40px auto; background:#fff; border-radius:16px; box-shadow:0 4px 24px #0001; padding:32px 32px 24px 32px; }
    h2 { font-size:28px; margin-bottom:24px; }
    .tab-btn { padding:8px 24px; border:none; border-radius:6px 6px 0 0; background:#eee; color:#333; font-weight:bold; margin-right:4px; cursor:pointer; }
    .tab-btn.active { background:#007bff; color:#fff; }
    .form-group { margin-bottom:18px; }
    label { font-weight:bold; color:#222; margin-bottom:6px; display:block; }
    .select-box { width:100%; padding:12px 16px; border-radius:8px; border:1px solid #ccc; font-size:16px; background:#f8f8f8; box-sizing:border-box; }
    .option-row { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
    .option-label { font-weight:bold; width:32px; text-align:right; }
    .submit-btn { width:100%; padding:14px 0; border-radius:8px; background:#007bff; color:#fff; font-size:18px; font-weight:bold; border:none; cursor:pointer; margin-top:12px; }
    #lotteryCreateResult { margin-top:16px; }
  </style>
</head>
<body>
<div class="lottery-container">
  <h2>抽獎設定</h2>
  <div style="margin-bottom:24px;">
  </div>

  <!-- 建立活動 -->
  <div id="tab-create-content">
    <form id="lotteryForm">
      <div class="form-group">
        <label>題目：</label>
        <input type="text" id="lotteryTitle" class="select-box" placeholder="請輸入抽獎題目" required />
      </div>
      <div class="form-group">
        <label>選項：</label>
        <div id="optionList">
          <div class="option-row"><span class="option-label">A：</span><input type="text" class="select-box" name="optionA" placeholder="選項A"></div>
          <div class="option-row"><span class="option-label">B：</span><input type="text" class="select-box" name="optionB" placeholder="選項B"></div>
          <div class="option-row"><span class="option-label">C：</span><input type="text" class="select-box" name="optionC" placeholder="選項C"></div>
          <div class="option-row"><span class="option-label">D：</span><input type="text" class="select-box" name="optionD" placeholder="選項D"></div>
        </div>
        <small style="color:#888;">最多4個選項，空白欄位不會送出</small>
      </div>
      <div class="form-group">
        <label>設定答案：</label>
        <input type="text" id="lotteryAnswer" class="select-box" placeholder="請輸入正確答案 (如 A、B)" required />
      </div>
      <!-- 回答時間已移除 -->
      <div class="form-group">
        <label>設定抽獎人數：</label>
        <input type="number" id="lotteryWinnerCount" class="select-box" min="1" value="1" required />
      </div>
      <button type="button" class="submit-btn" onclick="submitLottery()">發布</button>
    </form>
    <div id="lotteryCreateResult"></div>
  </div>

  <!-- 活動紀錄 -->
  <!-- 活動紀錄分頁已移至 lottery-record.html -->
</div>
<script>
// 活動紀錄分頁已移至 lottery-record.html
function submitLottery() {
  const title = document.getElementById('lotteryTitle').value;
  const answer = document.getElementById('lotteryAnswer').value;
  const winnerCount = document.getElementById('lotteryWinnerCount').value;
  const options = ['optionA','optionB','optionC','optionD'].map(n => document.getElementsByName(n)[0].value.trim()).filter(Boolean);
  const channelId = window.parent && window.parent.document
    ? window.parent.document.getElementById('channels')?.value
    : (document.getElementById('channels') ? document.getElementById('channels').value : null);
  if (!channelId) {
    document.getElementById('lotteryCreateResult').textContent = '⚠️ 請先選擇發布頻道';
    return;
  }
  try {
    fetch('/api/start-lottery-event', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        question: title,
        options,
        answer,
        winners: Number(winnerCount),
        channelId
      })
    })
    .then(res => res.json())
    .then(result => {
      if (result.success) {
        document.getElementById('lotteryCreateResult').textContent = '✅ 抽獎活動已發布！';
        document.getElementById('lotteryForm').reset();
        loadLotteryList();
      } else {
        document.getElementById('lotteryCreateResult').textContent = '❌ 發布失敗：' + (result.error || '未知錯誤');
      }
    });
  } catch (err) {
    document.getElementById('lotteryCreateResult').textContent = '❌ 發布失敗：' + err.message;
  }
}
</script>
</body>
</html>
